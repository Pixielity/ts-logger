{"version":3,"sources":["../../src/channels/single-channel.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAcO,IAAM,gBAAN,MAA8C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAanD,WAAA,CAAY,IAAc,EAAA,OAAA,EAAsB,SAA0B,EAAA;AAT1E,IAAA,IAAA,CAAQ,aAA8B,EAAC;AACvC,IAAA,IAAA,CAAQ,UAAsB,EAAC;AAS7B,IAAA,IAAA,CAAK,IAAO,GAAA,IAAA;AACZ,IAAA,IAAA,CAAK,OAAU,GAAA,OAAA;AACf,IAAA,IAAA,CAAK,SAAY,GAAA,SAAA;AAAA;AACnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQO,GAAI,CAAA,KAAA,EAAiB,OAAiB,EAAA,OAAA,GAAsB,EAAU,EAAA;AAE3E,IAAA,IAAI,MAAoB,GAAA;AAAA,MACtB,KAAA;AAAA,MACA,SAAA,EAAW,MAAM,WAAY,EAAA;AAAA,MAC7B,OAAA;AAAA,MACA,SAAS,EAAE,GAAG,IAAK,CAAA,OAAA,EAAS,GAAG,OAAQ,EAAA;AAAA,MACvC,QAAA,sBAAc,IAAK;AAAA,KACrB;AAGA,IAAS,MAAA,GAAA,IAAA,CAAK,cAAc,MAAM,CAAA;AAGlC,IAAA,IAAI,IAAK,CAAA,OAAA,CAAQ,UAAW,CAAA,MAAM,CAAG,EAAA;AACnC,MAAK,IAAA,CAAA,OAAA,CAAQ,OAAO,MAAM,CAAA;AAAA;AAC5B;AACF;AAAA;AAAA;AAAA;AAAA,EAMO,YAAY,OAAqC,EAAA;AACtD,IAAA,IAAA,CAAK,UAAU,EAAE,GAAG,IAAK,CAAA,OAAA,EAAS,GAAG,OAAQ,EAAA;AAC7C,IAAO,OAAA,IAAA;AAAA;AACT;AAAA;AAAA;AAAA;AAAA,EAMO,eAAe,IAAgC,EAAA;AACpD,IAAA,MAAM,UAAyB,GAAA,EAAE,GAAG,IAAA,CAAK,OAAQ,EAAA;AACjD,IAAA,KAAA,MAAW,OAAO,IAAM,EAAA;AACtB,MAAA,OAAO,WAAW,GAAG,CAAA;AAAA;AAEvB,IAAA,IAAA,CAAK,OAAU,GAAA,UAAA;AACf,IAAO,OAAA,IAAA;AAAA;AACT;AAAA;AAAA;AAAA,EAKO,OAAkB,GAAA;AACvB,IAAA,OAAO,IAAK,CAAA,IAAA;AAAA;AACd;AAAA;AAAA;AAAA;AAAA,EAMO,cAAc,MAA8B,EAAA;AACjD,IAAA,IAAI,eAAkB,GAAA,MAAA;AAGtB,IAAW,KAAA,MAAA,SAAA,IAAa,KAAK,UAAY,EAAA;AACvC,MAAkB,eAAA,GAAA,SAAA,CAAU,QAAQ,eAAe,CAAA;AAAA;AAGrD,IAAO,OAAA,eAAA;AAAA;AACT;AAAA;AAAA;AAAA;AAAA,EAMO,aAAa,OAA2B,EAAA;AAC7C,IAAA,IAAA,CAAK,UAAU,EAAE,GAAG,IAAK,CAAA,OAAA,EAAS,GAAG,OAAQ,EAAA;AAAA;AAC/C;AAAA;AAAA;AAAA,EAKO,kBAA2B,GAAA;AAChC,IAAA,IAAA,CAAK,UAAU,EAAC;AAAA;AAClB;AAAA;AAAA;AAAA,EAKO,UAA0B,GAAA;AAC/B,IAAA,OAAO,IAAK,CAAA,OAAA;AAAA;AACd;AAAA;AAAA;AAAA;AAAA,EAMO,WAAW,OAA4B,EAAA;AAC5C,IAAA,IAAA,CAAK,OAAU,GAAA,OAAA;AAAA;AACjB;AAAA;AAAA;AAAA,EAKO,YAA8B,GAAA;AACnC,IAAA,OAAO,IAAK,CAAA,SAAA;AAAA;AACd;AAAA;AAAA;AAAA;AAAA,EAMO,aAAa,SAAgC,EAAA;AAClD,IAAA,IAAA,CAAK,SAAY,GAAA,SAAA;AAAA;AACnB;AAAA;AAAA;AAAA,EAKO,aAAiC,GAAA;AACtC,IAAA,OAAO,IAAK,CAAA,UAAA;AAAA;AACd;AAAA;AAAA;AAAA;AAAA,EAMO,aAAa,SAAgC,EAAA;AAClD,IAAK,IAAA,CAAA,UAAA,CAAW,KAAK,SAAS,CAAA;AAAA;AAChC;AAAA;AAAA;AAAA;AAAA,EAMO,gBAAgB,IAAoB,EAAA;AACzC,IAAK,IAAA,CAAA,UAAA,GAAa,KAAK,UAAW,CAAA,MAAA,CAAO,CAAC,SAAc,KAAA,SAAA,CAAU,OAAQ,EAAA,KAAM,IAAI,CAAA;AAAA;AAExF;AA3Ja,aAAN,GAAA,eAAA,CAAA;AAAA,EADN,UAAW;AAAA,CACC,EAAA,aAAA,CAAA","file":"single-channel.mjs","sourcesContent":["import { injectable } from 'inversify'\n\nimport type { LogContext, LogRecord } from '../types'\nimport type { LogLevel } from '../enums/log-level.enum'\nimport type { ILogHandler } from '../interfaces/handlers/log-handler.interface'\nimport type { ISingleChannel } from '../interfaces/channels/single-channel.interface'\nimport type { ILogFormatter } from '../interfaces/formatters/log-formatter.interface'\nimport type { ILogProcessor } from '../interfaces/processors/log-processor.interface'\n\n/**\n * SingleChannel is an implementation of the ISingleChannel interface.\n * It uses a single handler to process log messages.\n */\n@injectable()\nexport class SingleChannel implements ISingleChannel {\n  private name: string\n  private handler: ILogHandler\n  private formatter: ILogFormatter\n  private processors: ILogProcessor[] = []\n  private context: LogContext = {}\n\n  /**\n   * Create a new SingleChannel instance\n   * @param name The channel name\n   * @param handler The handler to use\n   * @param formatter The formatter to use\n   */\n  constructor(name: string, handler: ILogHandler, formatter: ILogFormatter) {\n    this.name = name\n    this.handler = handler\n    this.formatter = formatter\n  }\n\n  /**\n   * Log a message at the specified level\n   * @param level The log level\n   * @param message The message to log\n   * @param context Optional contextual data\n   */\n  public log(level: LogLevel, message: string, context: LogContext = {}): void {\n    // Create a log record\n    let record: LogRecord = {\n      level: level,\n      levelName: level.toUpperCase(),\n      message: message,\n      context: { ...this.context, ...context },\n      datetime: new Date(),\n    }\n\n    // Process the record with all processors\n    record = this.processRecord(record)\n\n    // Handle the record\n    if (this.handler.isHandling(record)) {\n      this.handler.handle(record)\n    }\n  }\n\n  /**\n   * Add contextual data to all subsequent log messages\n   * @param context The contextual data to add\n   */\n  public withContext(context: LogContext): ISingleChannel {\n    this.context = { ...this.context, ...context }\n    return this\n  }\n\n  /**\n   * Remove contextual data from all subsequent log messages\n   * @param keys The keys to remove from the context\n   */\n  public withoutContext(keys: string[]): ISingleChannel {\n    const newContext: LogContext = { ...this.context }\n    for (const key of keys) {\n      delete newContext[key]\n    }\n    this.context = newContext\n    return this\n  }\n\n  /**\n   * Get the channel name\n   */\n  public getName(): string {\n    return this.name\n  }\n\n  /**\n   * Process a log record\n   * @param record The log record to process\n   */\n  public processRecord(record: LogRecord): LogRecord {\n    let processedRecord = record\n\n    // Process the record with all processors\n    for (const processor of this.processors) {\n      processedRecord = processor.process(processedRecord)\n    }\n\n    return processedRecord\n  }\n\n  /**\n   * Share context across channels\n   * @param context The contextual data to share\n   */\n  public shareContext(context: LogContext): void {\n    this.context = { ...this.context, ...context }\n  }\n\n  /**\n   * Flush shared context\n   */\n  public flushSharedContext(): void {\n    this.context = {}\n  }\n\n  /**\n   * Get the handler used by the channel\n   */\n  public getHandler(): ILogHandler {\n    return this.handler\n  }\n\n  /**\n   * Set the handler used by the channel\n   * @param handler The handler to use\n   */\n  public setHandler(handler: ILogHandler): void {\n    this.handler = handler\n  }\n\n  /**\n   * Get the formatter used by the channel\n   */\n  public getFormatter(): ILogFormatter {\n    return this.formatter\n  }\n\n  /**\n   * Set the formatter used by the channel\n   * @param formatter The formatter to use\n   */\n  public setFormatter(formatter: ILogFormatter): void {\n    this.formatter = formatter\n  }\n\n  /**\n   * Get the processors used by the channel\n   */\n  public getProcessors(): ILogProcessor[] {\n    return this.processors\n  }\n\n  /**\n   * Add a processor to the channel\n   * @param processor The processor to add\n   */\n  public addProcessor(processor: ILogProcessor): void {\n    this.processors.push(processor)\n  }\n\n  /**\n   * Remove a processor from the channel\n   * @param name The name of the processor to remove\n   */\n  public removeProcessor(name: string): void {\n    this.processors = this.processors.filter((processor) => processor.getName() !== name)\n  }\n}\n"]}