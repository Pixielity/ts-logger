{"version":3,"sources":["../../src/processors/context-log-processor.ts","../../src/processors/message-placeholder-processor.ts"],"names":["injectable"],"mappings":"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","file":"index.mjs","sourcesContent":["import { injectable } from 'inversify'\n\nimport type { LogContext, LogRecord } from '../types'\nimport { ProcessorType } from '../enums/processor-type.enum'\nimport type { IContextLogProcessor } from '../interfaces/processors/context-log-processor.interface'\n\n/**\n * ContextLogProcessor is an implementation of the IContextLogProcessor interface.\n * It adds contextual data to log records.\n */\n@injectable()\nexport class ContextLogProcessor implements IContextLogProcessor {\n  private name = ProcessorType.CONTEXT\n  private context: LogContext = {}\n\n  /**\n   * Create a new ContextLogProcessor instance\n   * @param context Initial context\n   */\n  constructor(context: LogContext = {}) {\n    this.context = context\n  }\n\n  /**\n   * Process a log record\n   * @param record The log record to process\n   */\n  public process(record: LogRecord): LogRecord {\n    // Merge the processor's context with the record's context\n    const mergedContext = { ...this.context, ...record.context }\n\n    // Return the updated record\n    return {\n      ...record,\n      context: mergedContext,\n    }\n  }\n\n  /**\n   * Add contextual data to all subsequent log records\n   * @param context The contextual data to add\n   */\n  public addContext(context: LogContext): void {\n    this.context = { ...this.context, ...context }\n  }\n\n  /**\n   * Remove contextual data from all subsequent log records\n   * @param keys The keys to remove from the context\n   */\n  public removeContext(keys: string[]): void {\n    const newContext: LogContext = { ...this.context }\n    for (const key of keys) {\n      delete newContext[key]\n    }\n    this.context = newContext\n  }\n\n  /**\n   * Get the current context\n   */\n  public getContext(): LogContext {\n    return this.context\n  }\n\n  /**\n   * Clear the current context\n   */\n  public clearContext(): void {\n    this.context = {}\n  }\n\n  /**\n   * Get the processor name\n   */\n  public getName(): string {\n    return this.name\n  }\n}\n","import { injectable } from 'inversify'\n\nimport type { LogRecord } from '../types/log-record.type'\nimport { ProcessorType } from '../enums/processor-type.enum'\nimport type { IMessagePlaceholderProcessor } from '../interfaces/processors/message-placeholder-processor.interface'\n\n/**\n * MessagePlaceholderProcessor is an implementation of the IMessagePlaceholderProcessor interface.\n * It replaces placeholders in log messages with context values.\n */\n@injectable()\nexport class MessagePlaceholderProcessor implements IMessagePlaceholderProcessor {\n  private name = ProcessorType.MESSAGE_PLACEHOLDER\n  private placeholderFormat = '{key}'\n  private emojiSupport = true\n\n  /**\n   * Create a new MessagePlaceholderProcessor instance\n   * @param options Options for the processor\n   */\n  constructor(options: { placeholderFormat?: string; emojiSupport?: boolean } = {}) {\n    if (options.placeholderFormat) {\n      this.placeholderFormat = options.placeholderFormat\n    }\n    if (options.emojiSupport !== undefined) {\n      this.emojiSupport = options.emojiSupport\n    }\n  }\n\n  /**\n   * Process a log record\n   * @param record The log record to process\n   */\n  public process(record: LogRecord): LogRecord {\n    // Replace placeholders in the message\n    const message = this.replacePlaceholders(record.message, record.context)\n\n    // Return the updated record\n    return {\n      ...record,\n      message,\n    }\n  }\n\n  /**\n   * Replace placeholders in a message with corresponding context values.\n   * The placeholder format is dynamically determined (e.g., '{key}', '%key%', '{{var}}', etc.).\n   *\n   * @param message - The input message string that may contain placeholders.\n   * @param context - A dictionary of keys and values used to replace placeholders.\n   * @returns The message with placeholders replaced by context values.\n   */\n  private replacePlaceholders(message: string, context: Record<string, any>): string {\n    // If the message is empty or there is no context to apply, return the message as is\n    if (!message || !context || Object.keys(context).length === 0) {\n      return message\n    }\n\n    // Retrieve the placeholder format pattern (e.g., '{key}', '{{var}}', '%key%')\n    const pattern = this.getPlaceholderPattern()\n\n    /**\n     * Match and extract the parts of the pattern:\n     * - group 1: prefix (before 'key' or 'var')\n     * - group 2: the token placeholder ('key' or 'var')\n     * - group 3: suffix (after 'key' or 'var')\n     */\n    const match = pattern.match(/^(.*)(key|var)(.*)$/)\n\n    // If pattern does not include 'key' or 'var', we can't process it\n    if (!match) return message\n\n    // Destructure the match groups: prefix and suffix around the token name\n    const [, prefix, , suffix] = match\n\n    /**\n     * Build a dynamic RegExp using the detected prefix and suffix\n     * Example: if prefix='{', suffix='}', it becomes /\\{(\\w+)\\}/g\n     * The (\\w+) group captures the placeholder token (e.g., \"user\" in \"{user}\")\n     */\n    const regex = new RegExp(this.escapeRegExp(prefix) + '(\\\\w+)' + this.escapeRegExp(suffix), 'g')\n\n    // Replace each matched placeholder in the message\n    return message.replace(regex, (_fullMatch, token) => {\n      // Look up the token in the context\n      const value = context[token]\n\n      // If the token isn't found or is null/undefined, replace with an empty string\n      if (value === undefined || value === null) return ''\n\n      // If value is an object (e.g., array, plain object), convert it to a JSON string\n      if (typeof value === 'object') return this.convertToString(value)\n\n      // If emoji support is enabled and value is a string emoji, use it as-is\n      if (this.emojiSupport && typeof value === 'string' && this.isEmoji(value)) {\n        return value\n      }\n\n      // Otherwise, return the value converted to a string\n      return String(value)\n    })\n  }\n\n  /**\n   * Get the placeholder pattern\n   */\n  private getPlaceholderPattern(): string {\n    return this.placeholderFormat\n  }\n\n  /**\n   * Escape special characters in a string for use in a regular expression\n   * @param string The string to escape\n   */\n  private escapeRegExp(string: string): string {\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\n  }\n\n  /**\n   * Convert a value to a string\n   * @param value The value to convert\n   */\n  private convertToString(value: any): string {\n    if (value === null || value === undefined) {\n      return ''\n    }\n    if (typeof value === 'object') {\n      return JSON.stringify(value)\n    }\n    return String(value)\n  }\n\n  /**\n   * Check if a string is an emoji\n   * @param string The string to check\n   */\n  private isEmoji(string: string): boolean {\n    // Simple check for emoji (Unicode emoji range)\n    const emojiRegex = /[\\u{1F300}-\\u{1F6FF}\\u{1F900}-\\u{1F9FF}\\u{2600}-\\u{26FF}\\u{2700}-\\u{27BF}]/u\n    return emojiRegex.test(string)\n  }\n\n  /**\n   * Get the processor name\n   */\n  public getName(): string {\n    return this.name\n  }\n\n  /**\n   * Set the placeholder format\n   * @param format The placeholder format (e.g., '{key}')\n   */\n  public setPlaceholderFormat(format: string): void {\n    this.placeholderFormat = format\n  }\n\n  /**\n   * Get the placeholder format\n   */\n  public getPlaceholderFormat(): string {\n    return this.placeholderFormat\n  }\n\n  /**\n   * Enable or disable emoji support\n   * @param enabled Whether emoji support is enabled\n   */\n  public setEmojiSupport(enabled: boolean): void {\n    this.emojiSupport = enabled\n  }\n\n  /**\n   * Get whether emoji support is enabled\n   */\n  public isEmojiSupportEnabled(): boolean {\n    return this.emojiSupport\n  }\n}\n"]}